---
layout: post
title: 1930. Unique Length-3 Palindromic Subsequences
image: Mine/1694882289278.jpg
date: 2025-01-04 20:00:00 +0900
tags: [Problem_Solving]
categories: Problem_Solving
difficulty: Medium
topics: [Hash Table, String, Bit Manipulation, Prefix Sum]
---

# 1930. Unique Length-3 Palindromic Subsequences
[ë¬¸ì œ ë§í¬](https://leetcode.com/problems/unique-length-3-palindromic-subsequences/description/?envType=daily-question&envId=2025-01-04)

<br/>

## ë‚´ ì½”ë“œ
í•´ì„¤ ì°¸ê³ .

<br/>

## Solution

### Approach 1: Count Letters In-Between
- *176ms, 15.95MB*
- Complexity
  - Given $n$ as the length of $s$.
  - Time Complexity: $O(n)$
  - Space Complexity: $O(1)$

```cpp
class Solution {
public:
    int countPalindromicSubsequence(string s) {
        unordered_set<char> letters;
        for (char c : s) {
            letters.insert(c);
        }
        
        int ans = 0;
        for (char letter : letters) {
            int i = -1;
            int j = 0;
            
            for (int k = 0; k < s.size(); k++) {
                if (s[k] == letter) {
                    if (i == -1) {
                        i = k;
                    }
                    
                    j = k;
                }
            }
            
            unordered_set<char> between;
            for (int k = i + 1; k < j; k++) {
                between.insert(s[k]);
            }
            
            ans += between.size();
        }
        
        return ans;
    }
};


```

<br/>

#### GPT
ì´ ì½”ë“œëŠ” **ê¸¸ì´ê°€ 3ì¸ íšŒë¬¸(íŒ°ë¦°ë“œë¡¬) ë¶€ë¶„ ìˆ˜ì—´**ì˜ ê°œìˆ˜ë¥¼ ì°¾ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.  
ì¦‰, **í˜•íƒœê°€ `x _ x`ì¸ ë¶€ë¶„ ìˆ˜ì—´**(`x`ëŠ” ê°™ì€ ë¬¸ì, `_`ëŠ” ì•„ë¬´ ë¬¸ì ê°€ëŠ¥)ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.  

---

## **ğŸ” ì½”ë“œ ê°œìš”**
1. **ë¬¸ì ì§‘í•©(`unordered_set`)ì„ ì‚¬ìš©í•˜ì—¬ ì¤‘ë³µ ë¬¸ì ì œê±°**  
   - ë¬¸ìì—´ `s`ì—ì„œ ê³ ìœ í•œ ë¬¸ìë§Œ ê³ ë ¤.
2. **ê° ë¬¸ìì˜ ì²« ë²ˆì§¸(`i`)ì™€ ë§ˆì§€ë§‰(`j`) ë“±ì¥ ìœ„ì¹˜ë¥¼ ì°¾ìŒ**  
3. **`i`ì™€ `j` ì‚¬ì´ì˜ ì„œë¡œ ë‹¤ë¥¸ ë¬¸ì ê°œìˆ˜ë¥¼ ì„¸ì–´ ì¹´ìš´íŠ¸**  
   - **ê° ì¤‘ê°„ ë¬¸ìê°€ `x _ x` í˜•íƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ**  
4. **ê° ë¬¸ìì— ëŒ€í•´ `between.size()`ë¥¼ ë”í•¨**  
   - `between.size()`ëŠ” `i`ì™€ `j` ì‚¬ì´ì— ìˆëŠ” ì„œë¡œ ë‹¤ë¥¸ ë¬¸ì ê°œìˆ˜

âœ… **ì‹œê°„ ë³µì¡ë„: O(26 * n) = O(n)** (ìµœëŒ€ 26ê°œì˜ ë¬¸ìë§Œ ê³ ë ¤)  
âœ… **ê³µê°„ ë³µì¡ë„: O(26) = O(1)** (ì•ŒíŒŒë²³ ì†Œë¬¸ìë§Œ ì €ì¥)

---

## **ğŸ“Œ ì½”ë“œ ë¶„ì„**
### **1ï¸âƒ£ ê³ ìœ  ë¬¸ì ì§‘í•© ìƒì„±**
```cpp
unordered_set<char> letters;
for (char c : s) {
    letters.insert(c);
}
```
- `unordered_set`ì„ ì‚¬ìš©í•˜ì—¬ `s`ì—ì„œ **ì¤‘ë³µ ì œê±°ëœ ë¬¸ì ì§‘í•©** `letters`ë¥¼ ìƒì„±.
- **ìµœëŒ€ 26ê°œ ë¬¸ìë§Œ ì €ì¥**í•˜ë¯€ë¡œ O(1) ê³µê°„ ì‚¬ìš©.

---

### **2ï¸âƒ£ ê° ë¬¸ìë³„ë¡œ ì²« ë²ˆì§¸(i)ì™€ ë§ˆì§€ë§‰(j) ìœ„ì¹˜ ì°¾ê¸°**
```cpp
for (char letter : letters) {
    int i = -1, j = 0;
    
    for (int k = 0; k < s.size(); k++) {
        if (s[k] == letter) {
            if (i == -1) { // ì²« ë²ˆì§¸ ë“±ì¥ ìœ„ì¹˜
                i = k;
            }
            j = k; // ë§ˆì§€ë§‰ ë“±ì¥ ìœ„ì¹˜
        }
    }
```
- `i`: `letter`ì˜ **ì²« ë²ˆì§¸ ë“±ì¥ ìœ„ì¹˜**
- `j`: `letter`ì˜ **ë§ˆì§€ë§‰ ë“±ì¥ ìœ„ì¹˜**
- `i == -1`ì¸ ê²½ìš°, ì²« ë²ˆì§¸ ë“±ì¥í•œ ìœ„ì¹˜ë¥¼ ì €ì¥
- ì´í›„ ê°™ì€ ë¬¸ìê°€ ë‚˜ì˜¤ë©´ `j`ë¥¼ ì—…ë°ì´íŠ¸í•˜ì—¬ **ë§ˆì§€ë§‰ ë“±ì¥ ìœ„ì¹˜ë¥¼ ì €ì¥**

---

### **3ï¸âƒ£ `i`ì™€ `j` ì‚¬ì´ì˜ ì„œë¡œ ë‹¤ë¥¸ ë¬¸ì ê°œìˆ˜ ì°¾ê¸°**
```cpp
unordered_set<char> between;
for (int k = i + 1; k < j; k++) {
    between.insert(s[k]);
}
```
- `i`ì™€ `j` ì‚¬ì´ì˜ ë¬¸ìë¥¼ `unordered_set`ì— ì¶”ê°€  
- **ê° ì¤‘ê°„ ë¬¸ìë§ˆë‹¤ `x _ x` í˜•íƒœì˜ íšŒë¬¸ì„ ë§Œë“¤ ìˆ˜ ìˆìŒ**  

âœ… **ì‹œê°„ ë³µì¡ë„ O(n) â†’ ì „ì²´ O(26 * n) = O(n)**  
âœ… **ê³µê°„ ë³µì¡ë„ O(26) = O(1) (ìµœëŒ€ 26ê°œ ë¬¸ì ì €ì¥)**  

---

### **4ï¸âƒ£ ê°€ëŠ¥í•œ íšŒë¬¸ ê°œìˆ˜ ëˆ„ì **
```cpp
ans += between.size();
```
- `between.size()`ëŠ” í˜„ì¬ ë¬¸ì(`letter`)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” `x _ x` í˜•íƒœì˜ íšŒë¬¸ ê°œìˆ˜.

---

### **5ï¸âƒ£ ìµœì¢… ê²°ê³¼ ë°˜í™˜**
```cpp
return ans;
```
âœ… **ëª¨ë“  ë¬¸ìì— ëŒ€í•´ ê³„ì‚°ëœ ê°œìˆ˜ë¥¼ ë°˜í™˜.**  

---

## **ğŸ“Œ ì˜ˆì œ ì‹¤í–‰**
```cpp
string s = "aabca";
Solution sol;
cout << sol.countPalindromicSubsequence(s);
```

### **Step 1: ê³ ìœ  ë¬¸ì ì°¾ê¸°**
`s = "aabca"`  
âœ… `letters = {'a', 'b', 'c'}`  

---

### **Step 2: ê° ë¬¸ìë³„ë¡œ `i`, `j` ì°¾ê¸° & ì¤‘ê°„ ë¬¸ì ê°œìˆ˜ ê³„ì‚°**
#### **(1) ë¬¸ì 'a'**
- `i = 0`, `j = 4`
- ì¤‘ê°„ ë¬¸ì: `"abc"`
âœ… `between.size() = 3`

#### **(2) ë¬¸ì 'b'**
- `i = 1`, `j = 1`
- ì¤‘ê°„ ë¬¸ì: ì—†ìŒ
âœ… `between.size() = 0`

#### **(3) ë¬¸ì 'c'**
- `i = 3`, `j = 3`
- ì¤‘ê°„ ë¬¸ì: ì—†ìŒ
âœ… `between.size() = 0`

---

### **ìµœì¢… ê²°ê³¼**
```
ans = 3 + 0 + 0 = 3
```
âœ… ì¶œë ¥: **`3`**

---

## **â± ì‹œê°„ ë³µì¡ë„ ë¶„ì„**

| ì—°ì‚° | ì‹œê°„ ë³µì¡ë„ |
|:---:|:---:|
| ê³ ìœ  ë¬¸ì ì°¾ê¸° | `O(n)` |
| ê° ë¬¸ìë³„ `i, j` ì°¾ê¸° | `O(n)` |
| ì¤‘ê°„ ë¬¸ì ê°œìˆ˜ ì°¾ê¸° | `O(n)` |
| ì „ì²´ ì‹œê°„ ë³µì¡ë„ | $O(26 * n) = O(n)$ |

âœ… **ìµœëŒ€ 26ê°œì˜ ë¬¸ìë§Œ ê³ ë ¤**í•˜ë¯€ë¡œ **O(n)** ì— í•´ê²° ê°€ëŠ¥!  
âœ… **ê³µê°„ ë³µì¡ë„ O(1)** (ë¬¸ì 26ê°œë§Œ ì €ì¥)

---

## **ğŸ’¡ ìµœì í™” ê°€ëŠ¥?**
### âœ… **ë” ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆëŠ” ë°©ë²•**
**`left[]`ì™€ `right[]` ë°°ì—´ì„ ì‚¬ìš©í•˜ì—¬ `i, j`ë¥¼ ë¹ ë¥´ê²Œ ì°¾ê¸°!**  

```cpp
class Solution {
public:
    int countPalindromicSubsequence(string s) {
        vector<int> first(26, -1), last(26, -1);
        for (int i = 0; i < s.size(); i++) {
            int idx = s[i] - 'a';
            if (first[idx] == -1) first[idx] = i;
            last[idx] = i;
        }

        int ans = 0;
        for (int c = 0; c < 26; c++) {
            if (first[c] == -1 || first[c] == last[c]) continue;

            unordered_set<char> between;
            for (int i = first[c] + 1; i < last[c]; i++) {
                between.insert(s[i]);
            }
            ans += between.size();
        }

        return ans;
    }
};
```

âœ… **`first[c]`ì™€ `last[c]`ë¥¼ ë¯¸ë¦¬ ê³„ì‚°** â†’ `O(n)`  
âœ… **`unordered_set`ì„ ì‚¬ìš©í•´ ì¤‘ê°„ ë¬¸ì ì°¾ê¸°** â†’ `O(n)`  
âœ… **ìµœì¢… ì‹œê°„ ë³µì¡ë„ = `O(n)`** ğŸš€

---

## **âœ… ê²°ë¡ **
âœ” **ê¸¸ì´ 3ì˜ íšŒë¬¸ ë¶€ë¶„ ìˆ˜ì—´(`x _ x`) ê°œìˆ˜ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì°¾ìŒ**  
âœ” **O(n)ìœ¼ë¡œ ìµœì í™”ëœ í’€ì´ ì‚¬ìš© ê°€ëŠ¥** ğŸš€  
âœ” **ë¬¸ìì—´ ë¬¸ì œì—ì„œ `unordered_set`ê³¼ `prefix/suffix index` í™œìš©ë²• ìµí ìˆ˜ ìˆìŒ** ğŸ¯

<br/>

### Approach 2: Pre-Compute First and Last Indices
- *146ms, 15.83MB*
- Complexity
  - Given $n$ as the length of $s$.
  - Time Complexity: $O(n)$
  - Space Complexity: $O(1)$

```cpp
class Solution {
public:
    int countPalindromicSubsequence(string s) {
        vector<int> first = vector(26, -1);
        vector<int> last = vector(26, -1);
        
        for (int i = 0; i < s.size(); i++) {
            int curr = s[i] - 'a';
            if (first[curr] == - 1) {
                first[curr] = i;
            }
            
            last[curr] = i;
        }
        
        int ans = 0;
        for (int i = 0; i < 26; i++) {
            if (first[i] == -1) {
                continue;
            }
            
            unordered_set<char> between;
            for (int j = first[i] + 1; j < last[i]; j++) {
                between.insert(s[j]);
            }
            
            ans += between.size();
        }
        
        return ans;
    }
};
```

<br/>

#### GPT
ì´ ì½”ë“œëŠ” **ê¸¸ì´ê°€ 3ì¸ íšŒë¬¸(íŒ°ë¦°ë“œë¡¬) ë¶€ë¶„ ìˆ˜ì—´**ì˜ ê°œìˆ˜ë¥¼ ì°¾ëŠ” ë¬¸ì œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í•´ê²°í•˜ëŠ” **O(n) ìµœì í™” ì½”ë“œ**ì…ë‹ˆë‹¤.  
ì¦‰, **í˜•íƒœê°€ `x _ x`ì¸ ë¶€ë¶„ ìˆ˜ì—´**(`x`ëŠ” ê°™ì€ ë¬¸ì, `_`ëŠ” ì•„ë¬´ ë¬¸ì ê°€ëŠ¥)ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.  

---

## **ğŸ” ì½”ë“œ ê°œìš”**
1. **ê° ì•ŒíŒŒë²³(`a~z`)ì˜ ì²« ë“±ì¥ ìœ„ì¹˜(`first[]`)ì™€ ë§ˆì§€ë§‰ ë“±ì¥ ìœ„ì¹˜(`last[]`) ì €ì¥**  
2. **ê° ë¬¸ì(`x`)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ `x _ x` í˜•íƒœì˜ ì¤‘ê°„ ë¬¸ìë¥¼ `unordered_set`ì„ ì´ìš©í•´ ì¹´ìš´íŠ¸**  
3. **ëª¨ë“  ë¬¸ìì— ëŒ€í•´ ê°€ëŠ¥í•œ `x _ x` í˜•íƒœì˜ ê°œìˆ˜ë¥¼ í•©ì‚°í•˜ì—¬ ë°˜í™˜**  

âœ… **O(n) ì‹œê°„, O(1) ê³µê°„** (ê³ ì •ëœ 26ê°œ ë¬¸ìë§Œ ì €ì¥)  
âœ… **ë¹ ë¥´ê³  ìµœì í™”ëœ ë°©ì‹** ğŸš€  

---

## **ğŸ“Œ ì½”ë“œ ë¶„ì„**
### **1ï¸âƒ£ `first[]`ì™€ `last[]` ë°°ì—´ ì´ˆê¸°í™”**
```cpp
vector<int> first(26, -1);
vector<int> last(26, -1);
```
- `first[i]`: ë¬¸ì `i`(`a`ë¶€í„° `z`)ì˜ **ì²« ë²ˆì§¸ ë“±ì¥ ì¸ë±ìŠ¤**  
- `last[i]`: ë¬¸ì `i`ì˜ **ë§ˆì§€ë§‰ ë“±ì¥ ì¸ë±ìŠ¤**  
- **ì²˜ìŒì—ëŠ” -1ë¡œ ì´ˆê¸°í™”** (ì•„ì§ ë“±ì¥í•˜ì§€ ì•ŠìŒ)

---

### **2ï¸âƒ£ `first[]`ì™€ `last[]` ì±„ìš°ê¸°**
```cpp
for (int i = 0; i < s.size(); i++) {
    int curr = s[i] - 'a';  // ë¬¸ì â†’ ì¸ë±ìŠ¤ ë³€í™˜
    if (first[curr] == -1) { 
        first[curr] = i; // ì²« ë“±ì¥ ê¸°ë¡
    }
    last[curr] = i; // ë§ˆì§€ë§‰ ë“±ì¥ ìœ„ì¹˜ ê³„ì† ê°±ì‹ 
}
```
âœ… **O(n)** ë§Œì— ë¬¸ìì—´ì„ í•œ ë²ˆë§Œ ìˆœíšŒí•˜ì—¬ `first[]`ì™€ `last[]` ê³„ì‚°  
âœ… **ë°°ì—´ ì ‘ê·¼ O(1) â†’ ë¹ ë¥¸ ìˆ˜í–‰ ê°€ëŠ¥**

---

### **3ï¸âƒ£ ê° ë¬¸ìë³„ `x _ x` ê°œìˆ˜ ê³„ì‚°**
```cpp
int ans = 0;
for (int i = 0; i < 26; i++) {  // a~z ìˆœíšŒ
    if (first[i] == -1) continue; // í•´ë‹¹ ë¬¸ìê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìŠ¤í‚µ

    unordered_set<char> between;
    for (int j = first[i] + 1; j < last[i]; j++) {
        between.insert(s[j]); // ì¤‘ê°„ ë¬¸ì ì¶”ê°€
    }

    ans += between.size(); // ê°€ëŠ¥í•œ íšŒë¬¸ì˜ ê°œìˆ˜ ì¶”ê°€
}
```
- `first[i] + 1`ë¶€í„° `last[i] - 1`ê¹Œì§€ ì¤‘ê°„ ë¬¸ì ìˆ˜ì§‘  
- **ì¤‘ë³µ ì œê±°ë¥¼ ìœ„í•´ `unordered_set` ì‚¬ìš©**  
- `between.size()`ë¥¼ `ans`ì— ë”í•¨  

âœ… **ê° ë¬¸ìì— ëŒ€í•´ O(n) ë°˜ë³µ â†’ ì´ O(26 * n) = O(n)**  

---

### **4ï¸âƒ£ ìµœì¢… ê²°ê³¼ ë°˜í™˜**
```cpp
return ans;
```
âœ… **ê°€ëŠ¥í•œ `x _ x` ê°œìˆ˜ë¥¼ ë°˜í™˜**

---

## **ğŸ“Œ ì˜ˆì œ ì‹¤í–‰**
```cpp
string s = "aabca";
Solution sol;
cout << sol.countPalindromicSubsequence(s);
```

### **Step 1: `first[]`, `last[]` ê³„ì‚°**
`s = "aabca"` 

| ë¬¸ì | ì²« ë“±ì¥ `first[i]` | ë§ˆì§€ë§‰ ë“±ì¥ `last[i]` |
|:---:|:---:|:---:|
| 'a'  | `0`              | `4`              |
| 'b'  | `1`              | `1`              |
| 'c'  | `3`              | `3`              |

âœ… `first = [0, 1, 3, -1, -1, ...]`  
âœ… `last = [4, 1, 3, -1, -1, ...]`  

---

### **Step 2: ê°€ëŠ¥í•œ `x _ x` ê°œìˆ˜ ê³„ì‚°**
#### **(1) ë¬¸ì 'a'**
- `i = 0`, `j = 4`
- ì¤‘ê°„ ë¬¸ì: `"abc"`
âœ… `between.size() = 3`

#### **(2) ë¬¸ì 'b'**
- `i = 1`, `j = 1`
- ì¤‘ê°„ ë¬¸ì: ì—†ìŒ
âœ… `between.size() = 0`

#### **(3) ë¬¸ì 'c'**
- `i = 3`, `j = 3`
- ì¤‘ê°„ ë¬¸ì: ì—†ìŒ
âœ… `between.size() = 0`

---

### **ìµœì¢… ê²°ê³¼**
```
ans = 3 + 0 + 0 = 3
```
âœ… ì¶œë ¥: **`3`**

---

## **â± ì‹œê°„ ë³µì¡ë„ ë¶„ì„**

| ì—°ì‚° | ì‹œê°„ ë³µì¡ë„ |
|:---:|:---:|
| `first[]`, `last[]` ê³„ì‚° | `O(n)` |
| ê° ë¬¸ì(`a~z`) ì¤‘ê°„ ë¬¸ì ì°¾ê¸° | `O(n)` |
| ì „ì²´ ì‹œê°„ ë³µì¡ë„ | **O(n)** |

âœ… **ìµœëŒ€ 26ê°œì˜ ë¬¸ìë§Œ ê³ ë ¤**í•˜ë¯€ë¡œ **O(n)** ì— í•´ê²° ê°€ëŠ¥!  
âœ… **ê³µê°„ ë³µì¡ë„ O(1)** (ê³ ì •ëœ 26ê°œ ë°°ì—´ë§Œ ì‚¬ìš©)

---

## **ğŸ’¡ ê°œì„  ë° ìµœì í™”**
### âœ… **`unordered_set` ëŒ€ì‹  `bitset`ì„ ì‚¬ìš©í•˜ë©´ ë” ë¹ ë¥´ê²Œ ê°€ëŠ¥!**
```cpp
class Solution {
public:
    int countPalindromicSubsequence(string s) {
        vector<int> first(26, -1), last(26, -1);
        for (int i = 0; i < s.size(); i++) {
            int idx = s[i] - 'a';
            if (first[idx] == -1) first[idx] = i;
            last[idx] = i;
        }

        int ans = 0;
        for (int i = 0; i < 26; i++) {
            if (first[i] == -1) continue;

            bitset<26> between;
            for (int j = first[i] + 1; j < last[i]; j++) {
                between.set(s[j] - 'a');
            }
            ans += between.count();
        }

        return ans;
    }
};
```
### ğŸš€ **ìµœì í™”ëœ ì½”ë“œì˜ ì¥ì **
âœ… `unordered_set` ëŒ€ì‹  `bitset<26>`ì„ ì‚¬ìš©í•˜ì—¬ **ë©”ëª¨ë¦¬ ì ˆì•½ & ë” ë¹ ë¥¸ ì‹¤í–‰**  
âœ… **O(1) ê³µê°„, O(n) ì‹¤í–‰ ì‹œê°„** ìœ ì§€  
âœ… `bitset.count()`ëŠ” **O(1) ì—°ì‚°**ì´ë¼ `unordered_set`ë³´ë‹¤ ë¹ ë¦„

---

## **âœ… ê²°ë¡ **
âœ” **O(n) ìµœì í™”ëœ ì•Œê³ ë¦¬ì¦˜!** ğŸš€  
âœ” **ëˆ„ì  ì¸ë±ìŠ¤(`first`, `last`)ë¥¼ ì´ìš©í•´ ë¹ ë¥´ê²Œ í•´ê²°**  
âœ” **`unordered_set` ëŒ€ì‹  `bitset`ì„ ì‚¬ìš©í•˜ë©´ ë” ë¹ ë¦„**  
âœ” **íšŒë¬¸ ë¬¸ì œì—ì„œ `prefix/suffix index` í™œìš©ë²• ìµí ìˆ˜ ìˆìŒ** ğŸ¯  

<br/>
